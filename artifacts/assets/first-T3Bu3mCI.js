import{r as s,o as D,m as T,q as F,j as o,x as R,w as N,z as Q,p as te,aF as ne,J as B,v as Y,y as oe,u as se,B as $,T as U,e as Z,A as le,C as ie,c as ce}from"./index-mIG69d0_.js";import{a as de}from"./index-SPfG3NXw.js";import{F as pe}from"./index.es-B27EdhAD.js";import{A as q,R as ue,f as me}from"./index-BJ3syGe5.js";const O=s.createContext({}),X=s.createContext({});function ve(e){return D("MuiStep",e)}T("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const fe=e=>{const{classes:t,orientation:r,alternativeLabel:n,completed:l}=e;return Q({root:["root",r,n&&"alternativeLabel",l&&"completed"]},ve,t)},be=R("div",{name:"MuiStep",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.orientation],r.alternativeLabel&&t.alternativeLabel,r.completed&&t.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),xe=s.forwardRef(function(t,r){const n=F({props:t,name:"MuiStep"}),{active:l,children:u,className:b,component:d="div",completed:p,disabled:i,expanded:x=!1,index:c,last:S,...g}=n,{activeStep:w,connector:y,alternativeLabel:m,orientation:k,nonLinear:I}=s.useContext(O);let[C=!1,M=!1,a=!1]=[l,p,i];w===c?C=l!==void 0?l:!0:!I&&w>c?M=p!==void 0?p:!0:!I&&w<c&&(a=i!==void 0?i:!0);const L=s.useMemo(()=>({index:c,last:S,expanded:x,icon:c+1,active:C,completed:M,disabled:a}),[c,S,x,C,M,a]),h={...n,active:C,orientation:k,alternativeLabel:m,completed:M,disabled:a,expanded:x,component:d},j=fe(h),v=o.jsxs(be,{as:d,className:N(j.root,b),ref:r,ownerState:h,...g,children:[y&&m&&c!==0?y:null,u]});return o.jsx(X.Provider,{value:L,children:y&&!m&&c!==0?o.jsxs(s.Fragment,{children:[y,v]}):v})}),Se=te(o.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"}),"CheckCircle"),ge=te(o.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}),"Warning");function he(e){return D("MuiStepIcon",e)}const G=T("MuiStepIcon",["root","active","completed","error","text"]);var ee;const ye=e=>{const{classes:t,active:r,completed:n,error:l}=e;return Q({root:["root",r&&"active",n&&"completed",l&&"error"],text:["text"]},he,t)},K=R(ne,{name:"MuiStepIcon",slot:"Root",overridesResolver:(e,t)=>t.root})(B(({theme:e})=>({display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),color:(e.vars||e).palette.text.disabled,[`&.${G.completed}`]:{color:(e.vars||e).palette.primary.main},[`&.${G.active}`]:{color:(e.vars||e).palette.primary.main},[`&.${G.error}`]:{color:(e.vars||e).palette.error.main}}))),Ce=R("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(e,t)=>t.text})(B(({theme:e})=>({fill:(e.vars||e).palette.primary.contrastText,fontSize:e.typography.caption.fontSize,fontFamily:e.typography.fontFamily}))),Le=s.forwardRef(function(t,r){const n=F({props:t,name:"MuiStepIcon"}),{active:l=!1,className:u,completed:b=!1,error:d=!1,icon:p,...i}=n,x={...n,active:l,completed:b,error:d},c=ye(x);if(typeof p=="number"||typeof p=="string"){const S=N(u,c.root);return d?o.jsx(K,{as:ge,className:S,ref:r,ownerState:x,...i}):b?o.jsx(K,{as:Se,className:S,ref:r,ownerState:x,...i}):o.jsxs(K,{className:S,ref:r,ownerState:x,...i,children:[ee||(ee=o.jsx("circle",{cx:"12",cy:"12",r:"12"})),o.jsx(Ce,{className:c.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:x,children:p})]})}return p});function je(e){return D("MuiStepLabel",e)}const A=T("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),we=e=>{const{classes:t,orientation:r,active:n,completed:l,error:u,disabled:b,alternativeLabel:d}=e;return Q({root:["root",r,u&&"error",b&&"disabled",d&&"alternativeLabel"],label:["label",n&&"active",l&&"completed",u&&"error",b&&"disabled",d&&"alternativeLabel"],iconContainer:["iconContainer",n&&"active",l&&"completed",u&&"error",b&&"disabled",d&&"alternativeLabel"],labelContainer:["labelContainer",d&&"alternativeLabel"]},je,t)},Re=R("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.orientation]]}})({display:"flex",alignItems:"center",[`&.${A.alternativeLabel}`]:{flexDirection:"column"},[`&.${A.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),Ie=R("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(e,t)=>t.label})(B(({theme:e})=>({...e.typography.body2,display:"block",transition:e.transitions.create("color",{duration:e.transitions.duration.shortest}),[`&.${A.active}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${A.completed}`]:{color:(e.vars||e).palette.text.primary,fontWeight:500},[`&.${A.alternativeLabel}`]:{marginTop:16},[`&.${A.error}`]:{color:(e.vars||e).palette.error.main}}))),ke=R("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(e,t)=>t.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${A.alternativeLabel}`]:{paddingRight:0}}),Me=R("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(e,t)=>t.labelContainer})(B(({theme:e})=>({width:"100%",color:(e.vars||e).palette.text.secondary,[`&.${A.alternativeLabel}`]:{textAlign:"center"}}))),re=s.forwardRef(function(t,r){const n=F({props:t,name:"MuiStepLabel"}),{children:l,className:u,componentsProps:b={},error:d=!1,icon:p,optional:i,slots:x={},slotProps:c={},StepIconComponent:S,StepIconProps:g,...w}=n,{alternativeLabel:y,orientation:m}=s.useContext(O),{active:k,disabled:I,completed:C,icon:M}=s.useContext(X),a=p||M;let L=S;a&&!L&&(L=Le);const h={...n,active:k,alternativeLabel:y,completed:C,disabled:I,error:d,orientation:m},j=we(h),v={slots:x,slotProps:{stepIcon:g,...b,...c}},[J,W]=Y("label",{elementType:Ie,externalForwardedProps:v,ownerState:h}),[P,E]=Y("stepIcon",{elementType:L,externalForwardedProps:v,ownerState:h});return o.jsxs(Re,{className:N(j.root,u),ref:r,ownerState:h,...w,children:[a||P?o.jsx(ke,{className:j.iconContainer,ownerState:h,children:o.jsx(P,{completed:C,active:k,error:d,icon:a,...E})}):null,o.jsxs(Me,{className:j.labelContainer,ownerState:h,children:[l?o.jsx(J,{...W,className:N(j.label,W==null?void 0:W.className),children:l}):null,i]})]})});re.muiName="StepLabel";function We(e){return D("MuiStepConnector",e)}T("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const $e=e=>{const{classes:t,orientation:r,alternativeLabel:n,active:l,completed:u,disabled:b}=e,d={root:["root",r,n&&"alternativeLabel",l&&"active",u&&"completed",b&&"disabled"],line:["line",`line${oe(r)}`]};return Q(d,We,t)},Ae=R("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.orientation],r.alternativeLabel&&t.alternativeLabel,r.completed&&t.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),Ne=R("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.line,t[`line${oe(r.orientation)}`]]}})(B(({theme:e})=>{const t=e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[600];return{display:"block",borderColor:e.vars?e.vars.palette.StepConnector.border:t,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),Pe=s.forwardRef(function(t,r){const n=F({props:t,name:"MuiStepConnector"}),{className:l,...u}=n,{alternativeLabel:b,orientation:d="horizontal"}=s.useContext(O),{active:p,disabled:i,completed:x}=s.useContext(X),c={...n,alternativeLabel:b,orientation:d,active:p,completed:x,disabled:i},S=$e(c);return o.jsx(Ae,{className:N(S.root,l),ref:r,ownerState:c,...u,children:o.jsx(Ne,{className:S.line,ownerState:c})})});function ze(e){return D("MuiStepper",e)}T("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const Ue=e=>{const{orientation:t,nonLinear:r,alternativeLabel:n,classes:l}=e;return Q({root:["root",t,r&&"nonLinear",n&&"alternativeLabel"]},ze,l)},De=R("div",{name:"MuiStepper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.orientation],r.alternativeLabel&&t.alternativeLabel,r.nonLinear&&t.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),Te=o.jsx(Pe,{}),Fe=s.forwardRef(function(t,r){const n=F({props:t,name:"MuiStepper"}),{activeStep:l=0,alternativeLabel:u=!1,children:b,className:d,component:p="div",connector:i=Te,nonLinear:x=!1,orientation:c="horizontal",...S}=n,g={...n,nonLinear:x,alternativeLabel:u,orientation:c,component:p},w=Ue(g),y=s.Children.toArray(b).filter(Boolean),m=y.map((I,C)=>s.cloneElement(I,{index:C,last:C+1===y.length,...I.props})),k=s.useMemo(()=>({activeStep:l,alternativeLabel:u,connector:i,nonLinear:x,orientation:c}),[l,u,i,x,c]);return o.jsx(O.Provider,{value:k,children:o.jsx(De,{as:p,ownerState:g,className:N(w.root,d),ref:r,...S,children:m})})}),_={WhatsApp:{hoverBg:"#25D366",color:"#fff"},Signal:{hoverBg:"#3A76F0",color:"#fff"}},Qe=[{name:"WhatsApp",img:o.jsx(ue,{})},{name:"Signal",img:o.jsx(pe,{icon:me})}],Be="https://sherlockwisdom.com:8080",Ee="wss://sherlockwisdom.com:8090",Ve=()=>{const[e,t]=s.useState(0),[r,n]=s.useState(""),[l,u]=s.useState(!1),[b,d]=s.useState(""),[p,i]=s.useState(""),[x,c]=s.useState(""),[S,g]=s.useState(!1),[w,y]=s.useState(null),m=s.useRef(null),k=se(),I=["Add Platform","Scan QR Code"],C=async a=>{var L,h,j;n(a),d(""),i(""),c(""),g(!0),y(null),m.current&&(m.current.close(),m.current=null);try{const v=localStorage.getItem("token"),J=localStorage.getItem("username")||"User";let W=a.toLowerCase();W==="whatsapp"&&(W="wa");const P=`${Be}/${W}/devices`,E={username:J,access_token:v};console.log("Add device payload:",E,"Endpoint:",P);const H=await de.post(P,E,{headers:{accept:"application/json","Content-Type":"application/json"}});if(console.log("Add device server response:",H.data),d("Device added successfully! Waiting for QR code..."),(L=H.data)!=null&&L.websocket_url){let z=H.data.websocket_url;z.startsWith("/")&&(z=`${Ee}${z}`);try{m.current=new window.WebSocket(z),m.current.binaryType="blob",m.current.onopen=()=>{console.log("WebSocket connected:",z)},m.current.onmessage=f=>{if(console.log("WebSocket message received:",f.data),g(!1),f.data instanceof Blob){const V=new FileReader;V.onload=function(ae){y(ae.target.result),t(1)},V.onerror=function(){i("Error reading binary image data."),g(!1)},V.readAsDataURL(f.data)}else typeof f.data=="string"?(f.data.startsWith("data:image/")?y(f.data):y(`data:image/png;base64,${f.data}`),t(1)):(i("Received unsupported data type for QR code."),g(!1))},m.current.onerror=f=>{console.error("WebSocket error:",f),i("WebSocket connection failed. Please ensure the backend WebSocket endpoint is running and accessible."),g(!1)},m.current.onclose=f=>{console.log("WebSocket closed",f,`code: ${f.code}`,`reason: ${f.reason}`,`wasClean: ${f.wasClean}`),!f.wasClean&&f.code!==1e3&&i(`WebSocket closed unexpectedly (code: ${f.code}, reason: ${f.reason})`),g(!1)}}catch(f){console.error("WebSocket connection error:",f),i("WebSocket connection error. Please check your backend and network."),g(!1)}}else i("WebSocket URL not provided by the server."),g(!1)}catch(v){(j=(h=v.response)==null?void 0:h.data)!=null&&j.message?(i(v.response.data.message),console.error("Add device error:",v.response.data.message,v.response)):(i(v.message||"Failed to add device"),console.error("Add device error:",v,v==null?void 0:v.response)),g(!1)}},M=()=>{if(r){let a=[];try{a=JSON.parse(localStorage.getItem("platforms")||"[]"),a.includes(r)||(a.push(r),localStorage.setItem("platforms",JSON.stringify(a)))}catch{localStorage.setItem("platforms",JSON.stringify([r]))}}localStorage.setItem("hasOnboarded","true"),k("/dashboard")};return s.useEffect(()=>()=>{m.current&&(m.current.close(),m.current=null)},[]),o.jsxs($,{sx:{width:"100%",maxWidth:600,margin:"auto",mt:4},children:[o.jsx(Fe,{activeStep:e,alternativeLabel:!0,children:I.map(a=>o.jsx(xe,{children:o.jsx(re,{children:a})},a))}),o.jsxs($,{sx:{mt:4},children:[e===0&&o.jsxs($,{children:[o.jsx(U,{variant:"h6",textAlign:"center",fontWeight:"bold",sx:{mb:2},children:"Select a platform to add"}),o.jsx(Z,{container:!0,spacing:3,justifyContent:"center",children:Qe.map(a=>{var L,h,j,v;return o.jsx(Z,{item:!0,children:o.jsxs($,{sx:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer",border:r===a.name?"2px solid #1976d2":"2px solid transparent",p:2,width:100,height:100,justifyContent:"center",transition:"border 0.2s, background 0.2s","&:hover":{background:((L=_[a.name])==null?void 0:L.hoverBg)||"#eee",color:((h=_[a.name])==null?void 0:h.color)||"inherit"},"&:hover .MuiAvatar-root":{background:"transparent"}},onClick:()=>C(a.name),children:[o.jsx(le,{sx:{bgcolor:r===a.name?(j=_[a.name])==null?void 0:j.hoverBg:"default",color:r===a.name?(v=_[a.name])==null?void 0:v.color:"inherit",mb:1,width:48,height:48,transition:"background 0.2s, color 0.2s"},children:a.img}),o.jsx(U,{variant:"body1",children:a.name})]})},a.name)})}),b&&o.jsx(q,{severity:"success",sx:{mt:2},children:b}),p&&o.jsx(q,{severity:"error",sx:{mt:2},children:p})]}),e===1&&o.jsxs($,{children:[S&&o.jsxs($,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2},children:[o.jsx(ie,{sx:{mb:2}}),o.jsx(U,{variant:"body2",children:"Waiting for QR code from device..."})]}),!S&&w?o.jsxs($,{sx:{textAlign:"center",mb:2},children:[o.jsx(U,{variant:"subtitle1",sx:{mb:1},children:"Scan this QR Code with your device"}),o.jsx($,{sx:{display:"inline-block",background:"#fff",border:"4px solid #1976d2",borderRadius:2,p:2,boxShadow:2},children:o.jsx("img",{src:w,alt:"QR Code",style:{width:320,height:320,maxWidth:"90vw",maxHeight:"90vw",imageRendering:"pixelated",background:"#fff",display:"block"}})})]}):null,!S&&!w&&!p&&o.jsx(U,{variant:"body2",textAlign:"center",color:"text.secondary",children:"Select a platform to generate a QR code."}),o.jsx(ce,{variant:"contained",color:"success",sx:{mt:2},onClick:M,children:"Finish"}),p&&o.jsx(q,{severity:"error",sx:{mt:2},children:p})]})]})]})};export{Ve as default};
