import{r as c,u as $,aJ as G,j as e,G as t,S as w,ak as f,at as M,aG as W,as as O,B as T,T as S,aH as N,c as H,aI as V}from"./index-mIG69d0_.js";import{F as J,c as Z,E as q,a as L,b as P,d as K,A as Q}from"./EyeInvisibleOutlined-Dgc55MOI.js";import{a as X}from"./index-SPfG3NXw.js";import{F as u,I as b}from"./InputLabel-DqDwIztU.js";const Y=s=>new RegExp(/[0-9]/).test(s),ee=s=>new RegExp(/[a-z]/).test(s)&&new RegExp(/[A-Z]/).test(s),se=s=>new RegExp(/[!#@$%^&*)(+=._-]/).test(s),re=s=>s<2?{label:"Poor",color:"error.main"}:s<3?{label:"Weak",color:"warning.main"}:s<4?{label:"Normal",color:"warning.dark"}:s<5?{label:"Good",color:"success.main"}:s<6?{label:"Strong",color:"success.dark"}:{label:"Poor",color:"error.main"},ae=s=>{let o=0;return s.length>5&&(o+=1),s.length>7&&(o+=1),Y(s)&&(o+=1),se(s)&&(o+=1),ee(s)&&(o+=1),o};function te(){const[s,o]=c.useState(),[p,U]=c.useState(!1),[y,j]=c.useState(""),[A,I]=c.useState(""),[k,R]=c.useState(!1),D=$(),E=()=>{U(!p)},v=r=>{r.preventDefault()},z=r=>{const i=ae(r);o(re(i))},[_]=G();return _.get("auth"),c.useEffect(()=>{z("")},[]),e.jsx(e.Fragment,{children:e.jsx(J,{initialValues:{username:"",password:"",repeatPassword:"",submit:null},validationSchema:Z().shape({username:P().max(255).required("Username is required"),password:P().required("Password is required").test("no-leading-trailing-whitespace","Password cannot start or end with spaces",r=>r===r.trim()).max(64,"Password must be less than 64 characters"),repeatPassword:P().required("Repeat Password is required").oneOf([K("password"),null],"Passwords must match")}),onSubmit:async(r,{setSubmitting:i,resetForm:h})=>{var n,l,m,x,B,C,F;j(""),I(""),R(!0);try{const a=await X.post("https://sherlockwisdom.com:8080/",{username:r.username,password:r.password});if(console.log("Register server response:",a.data),(n=a.data)!=null&&n.access_token&&(((l=a.data)==null?void 0:l.status)==="created"||((m=a.data)==null?void 0:m.status)==="logged in"))localStorage.setItem("isAuthenticated","true"),localStorage.setItem("token",a.data.access_token),localStorage.setItem("username",r.username),I("Signup successful! Redirecting..."),setTimeout(()=>{h(),D("/dashboard")},1e3);else{const g=[(x=a.data)==null?void 0:x.error,(B=a.data)==null?void 0:B.details,(C=a.data)==null?void 0:C.message].filter(Boolean).join(" - ")||"Signup failed: Unexpected server response";j(g),console.error("Signup failed: Unexpected server response",a.data)}}catch(d){const a=(F=d.response)==null?void 0:F.data,g=[a==null?void 0:a.error,a==null?void 0:a.details,a==null?void 0:a.message,d.message].filter(Boolean).join(" - ")||"Signup failed";j(g),console.error("Signup error:",g,d==null?void 0:d.response)}finally{R(!1),i(!1)}},children:({errors:r,handleBlur:i,handleChange:h,touched:n,values:l,handleSubmit:m})=>e.jsx("form",{noValidate:!0,onSubmit:m,children:e.jsxs(t,{container:!0,spacing:3,children:[y&&e.jsx(t,{size:12,children:e.jsx(u,{error:!0,children:y})}),A&&e.jsx(t,{size:12,children:e.jsx(u,{children:A})}),e.jsxs(t,{size:12,children:[e.jsxs(w,{sx:{gap:1},children:[e.jsx(b,{htmlFor:"username-signup",children:"Username*"}),e.jsx(f,{fullWidth:!0,error:!!(n.username&&r.username),id:"username-signup",type:"text",value:l.username,name:"username",onBlur:i,onChange:h,placeholder:"Enter username"})]}),n.username&&r.username&&e.jsx(u,{error:!0,id:"helper-text-username-signup",children:r.username})]}),e.jsxs(t,{size:12,children:[e.jsxs(w,{sx:{gap:1},children:[e.jsx(b,{htmlFor:"password-signup",children:"Password"}),e.jsx(f,{fullWidth:!0,error:!!(n.password&&r.password),id:"password-signup",type:p?"text":"password",value:l.password,name:"password",onBlur:i,onChange:x=>{h(x),z(x.target.value)},endAdornment:e.jsx(M,{position:"end",children:e.jsx(W,{"aria-label":"toggle password visibility",onClick:E,onMouseDown:v,edge:"end",color:"secondary",children:p?e.jsx(q,{}):e.jsx(L,{})})}),placeholder:"******"})]}),n.password&&r.password&&e.jsx(u,{error:!0,id:"helper-text-password-signup",children:r.password}),e.jsx(O,{fullWidth:!0,sx:{mt:2},children:e.jsxs(t,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(t,{children:e.jsx(T,{sx:{bgcolor:s==null?void 0:s.color,width:85,height:8,borderRadius:"7px"}})}),e.jsx(t,{children:e.jsx(S,{variant:"subtitle1",fontSize:"0.75rem",children:s==null?void 0:s.label})})]})})]}),e.jsxs(t,{size:12,children:[e.jsxs(w,{sx:{gap:1},children:[e.jsx(b,{htmlFor:"repeat-password-signup",children:"Repeat Password"}),e.jsx(f,{fullWidth:!0,error:!!(n.repeatPassword&&r.repeatPassword),id:"repeat-password-signup",type:p?"text":"password",value:l.repeatPassword,name:"repeatPassword",onBlur:i,onChange:h,placeholder:"******",endAdornment:e.jsx(M,{position:"end",children:e.jsx(W,{"aria-label":"toggle password visibility",onClick:E,onMouseDown:v,edge:"end",color:"secondary",children:p?e.jsx(q,{}):e.jsx(L,{})})})})]}),n.repeatPassword&&r.repeatPassword&&e.jsx(u,{error:!0,id:"helper-text-repeat-password-signup",children:r.repeatPassword})]}),r.submit&&e.jsx(t,{size:12,children:e.jsx(u,{error:!0,children:r.submit})}),e.jsx(t,{size:12,children:e.jsx(N,{children:e.jsx(H,{fullWidth:!0,size:"large",variant:"contained",color:"primary",type:"submit",disabled:k,children:k?"Creating Account...":"Create Account"})})})]})})})})}function de(){return e.jsx(Q,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{size:12,children:e.jsxs(w,{direction:"row",sx:{alignItems:"baseline",justifyContent:"space-between",mb:{xs:-.5,sm:.5}},children:[e.jsx(S,{variant:"h3",children:"Sign up"}),e.jsx(S,{component:V,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:"Already have an account?"})]})}),e.jsx(t,{size:12,children:e.jsx(te,{})})]})})}export{de as default};
